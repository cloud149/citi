/* This Support js will have added js functions we need to handle out of GlobalcomponentJs*/
$(document).ready(function(){
	
navigation();
featureGrid();
  fetureSingle();
  
  	function featureGrid(){
      if(document.getElementsByClassName("dcom-c-featureGrid")){
        setYoutubeLink();
        
      }
      
    }
	
	function setYoutubeLink(){
     $(".dcom-c-featureGrid__item--video").click(function(){
       var url= $(this ).find(".dcom-c-featureGrid__item-content").find(".dcom-c-featureGrid__item-link").attr("data-video");  
       var ID = refineVideoLink(url);
        
       //$("#dcom-featureGrid-video iframe").attr("src","https://www.youtube.com/embed/"+ID+"?rel=0&showinfo=0&autohide=1");
		document.getElementById("video_1").src = "https://www.youtube.com/embed/"+ID+"?rel=0&showinfo=0&autohide=1";
	   console.log("Inside setYoutubeLink---"+ document.getElementById("video_1").src);
                                                         
     })
  }
  
  function fetureSingle(){
    	$(".dcom-c-featureSingle__videoLink").click(function(){
			var	YTube_ID=refineVideoLink($(this ).attr("data-video"));
			
          	 //$("#dcom-featureSingle-video iframe").attr("src","https://www.youtube.com/embed/"+YTube_ID+"?rel=0&showinfo=0&autohide=1");
			document.getElementById("video_1").src = "https://www.youtube.com/embed/"+YTube_ID+"?rel=0&showinfo=0&autohide=1";
			console.log("Inside setYoutubeLink---"+ document.getElementById("video_1").src);
		})
       
  
  }
  
  
  function refineVideoLink(url){
  	var ID = '';
        url = url.replace(/(>|<)/gi,'').split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/);
        if(url[2] !== undefined) {
          ID = url[2].split(/[^0-9a-z_\-]/i);
          ID = ID[0];
        }
        else {
          ID = url;
        }
    return ID;
  }
  
	
	function navigation(){
		if(document.getElementById("dcom_navGlobal_bar")){/*this if condition confirms if navigation component is added in the page and ensures no other page loads this js */
			login();
			search();
			setPrimaryNav();
			setPrimaryNavMobile();	
			$("#dcom_navGlobal_bar").addClass('dcom-c-navigation-bar--hidden');
			$(".dcom-c-navigation-bar-mobile").removeClass('dcom-c-navigation-bar-mobile--active');
			$("#dcom-nav-secondary div nav ul li").each(function(){
				if($(this).children("div").children().length!=0){
					$(this).children("a").attr("href",'#')
				}
				
			})
			
		}
	}
	function login(){
		
		$(".dcom-c-navigation-bar__login button").click(function(){
			var selectedIndex=$("#loginDropdown")[0].selectedIndex;
			$(".dcom-c-nav-login__main .dcom-c-custom-select__wrapper .dcom-c-custom-select__selected").text($("#loginDropdown option:selected").text());
			$(".dcom-c-custom-select__items").attr("aria-activedescendant","option"+selectedIndex);
			$(".dcom-c-custom-select__items li").removeAttr("class");
			$(".dcom-c-custom-select__items li").removeAttr("aria-selected");
			$(".dcom-c-custom-select__items #option"+selectedIndex).attr("class","same-as-selected");
			$(".dcom-c-custom-select__items #option"+selectedIndex).attr("aria-selected","true");
          	if($("#loginDropdown option:selected").text() == "Personal/Small Business"){ //setting trouble login on initial load
              $(".dcom-c-nav-login__cta").removeAttr("style");
              $(".dcom-c-nav-login__help").removeAttr("style");
			};
		});
		
		$(".dcom-c-nav-login__button button").click(function(){
          if($("#loginDropdown").val()!=""){
			window.location= $("#loginDropdown").val();
          }
		});
		$("#dcom-nav-mobile-menu").click(function(){ //closing popup on mobile hamburger menu click
			if($(".dcom-c-navigation-bar__login .dcom-c-btn--inactive").length>0){
				$(".dcom-c-navigation-bar__login button").click();
			}
			
		})
		$("#dcom-nav-close").click(function(){ //closing popup on mobile close button click
			if($(".dcom-c-navigation-bar__login .dcom-c-btn--inactive").length>0){
				$(".dcom-c-navigation-bar__login button").click();
			}
			
		})
	}
	
	function search(){
      var specialChars = /[`^~<>"%\*#!()\]\[\{\}_\+\-\=\|\\\/]/;
      	$("#dcom-desktop_search-query").on('keypress', function(e) {
        return valSearchInput(e);
      });

       function valSearchInput(e) {
        if (e.which === 13) return true;
        return !specialChars.test(String.fromCharCode(e.which));
  		}
		$("#dcom-desktop-search-form").submit(function(event){
			  event.preventDefault();
			  desktopSearch();
		});
		$("#dcom-mobile-search-form").submit(function(event){
			  event.preventDefault();
			  mobileSearch();
		});
		$(".dcom-nav-desktop-search").click(function(){
			desktopSearch()});
		$(".dcom-nav-mobile-search").click(function(){
			mobileSearch()});
			
		function desktopSearch(){
          if($("#dcom-desktop_search-query").val()!=""){
			var searchQuery=$("#dcom-desktop_search-query").val();
			window.location='/search/answers.aspx?query='+encodeURI(searchQuery);
          }
			
		}
		function mobileSearch(){
          if($("#dcom-mobile_search-query").val()!=""){
			var searchQuery=$("#dcom-mobile_search-query").val();
			window.location='/search/answers.aspx?query='+encodeURI(searchQuery);
          }
			
		}
	
	}
		
	function setPrimaryNav(){
		var pageUrlPath=window.location.pathname.toLowerCase();
		var urlKeyWords =pageUrlPath.split("/");
		var urlKey ="/"+urlKeyWords[1]+"/";
		var primNavSet = false;
		var secNavSet = false;
		$("#primary-dcom-navrow-0").addClass("dcom-c-navigation-bar__li--active");
		$("#dcom-nav-secondary #dcom-navrow-0").removeClass("dcom-c-navigation-bar__secondary-row--hidden");
		$("#dcom-nav-primary li a").each(function(){
			var pLink= $(this).attr("href").toLowerCase();
				if(pLink.search(urlKey)!=-1){ 
					setNav($(this).parent().attr("id"));
					primNavSet=true;
					secNavSet=true;
					return false;
				}
			
		})
      	
		if(!primNavSet){/*when url doesnt match with primary key, going for secondary urls key words*/
			$("#dcom-nav-secondary div nav ul li").each(function(){ 
				var sLink= $(this).children("a").attr("href").toLowerCase();
				if(sLink.search(urlKey)!=-1){
					var primId="primary-"+$(this).parent().parent().parent().attr("id");
					setNav(primId);
					secNavSet = true;
					return false;
				}
			});
		}
		
		if(!secNavSet){
			$("#dcom-nav-secondary div nav ul li .dcom-c-navigation-bar__dropdown a").each(function(){ 
				var tLink= $(this).attr("href").toLowerCase();
				if(tLink.search(urlKey)!=-1){
					var primId="primary-"+$(this).parent().parent().parent().parent().parent().attr("id");
					setNav(primId);
					secNavSet = true;
					return false;
				}
			});
		}
		
	}
	function setNav(primaryId){
		var secId = primaryId.substring(8);
		$("#dcom-nav-primary li").removeClass("dcom-c-navigation-bar__li--active");
		$("#"+primaryId).addClass("dcom-c-navigation-bar__li--active");
		$("#dcom-nav-secondary .dcom-c-navigation-bar__secondary-row").addClass("dcom-c-navigation-bar__secondary-row--hidden"); 
		$("#"+secId).removeClass("dcom-c-navigation-bar__secondary-row--hidden");
	
	} 
	
	
	
	
		
	
	function setPrimaryNavMobile(){
		var idd = $(".dcom-c-navigation-bar__li--active").attr("id");
		mobileLi = "mobile-"+idd;
		$("#"+mobileLi).addClass("dcom-c-navigation-bar__li--active");
		$("#"+mobileLi+" a").attr("href","#");
      	if(document.querySelector("#"+mobileLi))
			mobileSecondary_Resize(document.querySelector("#"+mobileLi),false);
		
	}
	
	/*
    mobileDom == the element we want to resize, which is going to be one of the primary mobile dom elements, dcom-c-navigation-bar__li children of dcom-nav-mobile-primary
    reset == a Boolean to determine if we are closing or opening the navigation element.
        if true, it closes it (sets height to 0)
        if false, it opens it (sets height 51px * number of children)
*/
	
	function mobileSecondary_Resize(mobileDom,reset) {
        var tempMobileDiv = mobileDom.children[1];
		var numChildren = tempMobileDiv.children[0].children.length;
		var tabIndex;
		if(reset){
			tempMobileDiv.style.height = "0px";
			tabIndex = "-1";
		} else {
			tempMobileDiv.style.height = (51*numChildren)+"px";
			tabIndex = "0";
		}
		for(let n = 0; n < numChildren; n++){
			tempMobileDiv.children[0].children[n].tabIndex = tabIndex;
		}
	}
	
	 
});
	
	

	